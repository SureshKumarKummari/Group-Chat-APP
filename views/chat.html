<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chat App</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <!-- Bootstrap  icons -->

    <link rel="stylesheet" href="./style.css" />
</head>

<hr>
<h1 class=" rounded" style="text-align:center;">Welcome To Group Chat
</h1>
<hr>

<body>

    <div class="container-fluid" style="height: 100vh;">
        <div class="row" style="height: 100%;">

            <div id="sidebar" class="col-3 justify-content-start rounded" style="background-color: grey;">
                <div class="sidebar list-group" style="width: 100%;">
                    <ul class="list-group" style="width: 100%;">
                        <hr>
                        <li class="list-group-item" style="overflow:hidden;">
                            <button class="btn d-flex align-items-center" onclick="handlechat(this)">
                                <div class="col-2">
                                    <div class="avatar">
                                        <img src="https://t3.ftcdn.net/jpg/03/46/83/96/240_F_346839683_6nAPzbhpSkIpb8pmAwufkC7c5eD7wYws.jpg"
                                            alt="avatar">
                                    </div>
                                </div>
                                <div class="col-2"></div>
                                <div class="col">
                                    <h6>User1</h6>
                                    <!-- <h6>Last seen</h6> -->
                                </div>
                            </button>
                        </li>

                    </ul>
                </div>
            </div>


            <div class="col-8" style="display:none;" id="changecol">
                <div class="container">
                    <div id="header"></div>
                    <!-- msg-header section starts -->
                    
                    <!-- msg-header section ends -->

                    <div class="chat-page">
                        <div class="msg-inbox">
                            <div class="chats">
                                <!-- Message container -->
                                <div class="msg-page" id="msg-page">

                                    <!-- Outgoing messages -->
                                    

                                    <!--received chats--> 
                                </div>
                            </div>

                            <!-- msg-bottom section -->

                            <div class="msg-bottom">
                                <div class="input-group">
                                    <input type="text" id="message" class="form-control"
                                        placeholder="Type message..." />

                                    <button class="btn" onclick="handleSubmit()">
                                        <i class="bi bi-send"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>
</body>
<script src="../node_modules/socket.io/client-dist/socket.io.js"></script>
<script>


    function handlechat(buttonElement) {

        let chatwindow = document.getElementById('changecol');
        console.log(chatwindow.style.display);
        if (chatwindow.style.display == 'none') {
            chatwindow.style.display = 'block';
            console.log(chatwindow.style.display);
        }
        // Access the img and h6 elements inside the button
        let imgElement = buttonElement.querySelector('div.col-2 div.avatar img');
        let h6Element = buttonElement.querySelector('div.col h6');

        // Access the src attribute of the img element
        let imageUrl = imgElement.getAttribute('src');

        // Access the text content of the h6 element
        let username = h6Element.textContent;

        console.log("Username:", username);
        console.log("Image URL:", imageUrl);
        // Now you can use the username and imageUrl as needed in your function
        // For example, you can include them in the header HTML
        let header = document.getElementById('header');
        header.innerHTML = "";
        header.innerHTML = `<div class="msg-header">
        <div class="container1">
            <div class="col-2"></div>
        <img src="${imageUrl}" alt="avatar" class="msgimg"/>
        <div class="active"><p>${username}</p></div></div></div>`;
    }




    function addreceivedMessage(message) {

        let d = document.getElementById('msg-page');

        // Create the necessary DOM elements
        let receivedChatsDiv = document.createElement('div');
        receivedChatsDiv.classList.add('received-chats');

        let receivedChatsImgDiv = document.createElement('div');
        receivedChatsImgDiv.classList.add('received-chats-img');

        let img = document.createElement('img');
        img.setAttribute('src', 'user2.png');

        let receivedMsgDiv = document.createElement('div');
        receivedMsgDiv.classList.add('received-msg');

        let receivedMsgInboxDiv = document.createElement('div');
        receivedMsgInboxDiv.classList.add('received-msg-inbox');

        let p = document.createElement('p');
        p.classList.add('single-msg');
        p.textContent = message;

        let span = document.createElement('span');
        span.classList.add('time');
        span.textContent = '18:31 PM | July 24';

        // Append the elements to the appropriate parent elements
        receivedMsgInboxDiv.appendChild(p);
        receivedMsgInboxDiv.appendChild(span);

        receivedMsgDiv.appendChild(receivedMsgInboxDiv);

        receivedChatsImgDiv.appendChild(img);

        receivedChatsDiv.appendChild(receivedChatsImgDiv);
        receivedChatsDiv.appendChild(receivedMsgDiv);

        // Append the whole structure to the target element
        d.appendChild(receivedChatsDiv);

    }


    function addSentMessage(message) {
        let d = document.getElementById('msg-page');

        // Create the necessary DOM elements
        let outgoingChatsDiv = document.createElement('div');
        outgoingChatsDiv.classList.add('outgoing-chats');

        let outgoingChatsImgDiv = document.createElement('div');
        outgoingChatsImgDiv.classList.add('outgoing-chats-img');

        let img = document.createElement('img');
        img.setAttribute('src', 'user1.png');

        let outgoingMsgDiv = document.createElement('div');
        outgoingMsgDiv.classList.add('outgoing-msg');

        let outgoingMsgInboxDiv = document.createElement('div');
        outgoingMsgInboxDiv.classList.add('outgoing-chats-msg');

        let p = document.createElement('p');
        p.classList.add('multi-msg');
        p.textContent = message;

        let span = document.createElement('span');
        span.classList.add('time');
        span.textContent = '18:30 PM | July 24';

        // Append the elements to the appropriate parent elements
        outgoingMsgInboxDiv.appendChild(p);
        outgoingMsgInboxDiv.appendChild(span);

        outgoingMsgDiv.appendChild(outgoingMsgInboxDiv);

        outgoingChatsImgDiv.appendChild(img);

        outgoingChatsDiv.appendChild(outgoingChatsImgDiv);
        outgoingChatsDiv.appendChild(outgoingMsgDiv);

        // Append the whole structure to the target element
        d.appendChild(outgoingChatsDiv);


    }


    const socket = io('http://localhost:4000');

    function handleSubmit() {
        const message = document.getElementById('message').value;
        console.log(message);
        socket.emit('message', message);
        addSentMessage(message);
    }

    socket.on('message', (data) => {
        console.log('Received message:', data);
        addreceivedMessage(data);
    });


    const messageInput = document.getElementById('message');
    let typingTimeout;

    messageInput.addEventListener('input', () => {
        clearTimeout(typingTimeout);
        socket.emit('typing');
        typingTimeout = setTimeout(() => {
            socket.emit('stop typing');
        }, 1000);
    });


</script>
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js">
</script>

</html>